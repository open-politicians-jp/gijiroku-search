# 質問主意書データ問題分析・修正計画

## 🔍 現状分析

### 特定された問題

1. **データ品質問題**
   - 116件の質問データが全て合成/テンプレート化されている
   - 質問内容：全て「○○について、政府の見解を明らかにされたい」パターン
   - 答弁内容：全て「政府として適切に対応している」定型文
   - わずか5種類のタイトルの繰り返し

2. **データ整合性問題**
   - 質問番号とURL IDの不一致（例：質問#320 → URL: a217214.htm）
   - PDF ファイルサイズが質問番号と一致（疑わしい coincidence）
   - 答弁URLが全て空文字列
   - 未来の日付での質問提出・答弁

3. **技術的問題**
   - `collect_questions_fixed.py`は適切に設計されているが実際使用されていない
   - 別の合成データ生成メソッドが使用されている
   - URL構造の理解不足

### データファイル状況

- `questions_latest.json`: 116件の合成データ（構造化済み）
- `questions_enhanced_*.json`: 同様の合成データ 
- `questions_20250611_200440.json`: より基本的な構造

## 🛠️ 修正計画

### Phase 1: 実サイト調査・分析 (1-2日)

1. **衆議院質問主意書サイト構造の詳細分析**
   - https://www.shugiin.go.jp/internet/itdb_shitsumon.nsf/html/shitsumon/menu_m.htm
   - 実際のページ構造、HTML要素の特定
   - 質問・答弁・PDF の関連性確認

2. **URL パターン分析**
   - 質問番号と実際のURL IDの関係性
   - HTML版とPDF版の対応ルール
   - 答弁書のURL構造

3. **データ要素の特定**
   - 質問者名の正確な抽出方法
   - 質問・答弁本文の抽出ポイント
   - 提出日・答弁日の表示形式

### Phase 2: スクリプト修正・強化 (2-3日)

1. **`collect_questions_fixed.py` の修正**
   - 実際のサイト構造に基づくセレクタ修正
   - 質問・答弁本文の正確な抽出ロジック
   - URL正規化とリンク修正の強化

2. **データ検証機能の追加**
   - URL アクセス可能性のチェック
   - 質問番号とURLの整合性検証
   - 日付の妥当性チェック

3. **エラーハンドリング強化**
   - ページ構造変更への対応
   - アクセス制限への対処
   - 部分的失敗時のリカバリ

### Phase 3: データ再収集・クリーンアップ (2-3日)

1. **既存データの削除**
   - 合成データファイルの除去
   - バックアップの作成（参考用）

2. **実データの段階的収集**
   - 少数サンプルでのテスト収集
   - スクリプト動作確認・調整
   - 本格的なデータ収集実行

3. **データ品質保証**
   - 収集データの検証・サニティチェック
   - 重複除去・データクリーニング
   - フロントエンド表示の動作確認

### Phase 4: システム統合・テスト (1-2日)

1. **フロントエンド統合**
   - 新データフォーマットとの互換性確認
   - UI表示の調整（必要に応じて）

2. **エンドツーエンドテスト**
   - 検索機能の動作確認
   - リンクアクセス可能性の確認
   - パフォーマンステスト

## 🎯 期待される成果

### データ品質向上
- 実際の国会質問主意書データ
- 正確な質問者名・質問内容・答弁内容
- 有効なURL・PDF リンク

### システム信頼性向上
- データと実際の政府サイトの整合性
- ユーザーが信頼できる情報源
- 継続的なデータ更新体制

### 技術的改善
- 堅牢なスクレイピングシステム
- データ検証・品質保証の仕組み
- エラー処理とモニタリング

## 📋 実行優先順位

1. **高優先**: Phase 1 (実サイト分析) - データ問題の根本原因解決
2. **高優先**: Phase 2 (スクリプト修正) - 技術的な基盤整備
3. **中優先**: Phase 3 (データ再収集) - 品質の高いデータ確保
4. **中優先**: Phase 4 (システム統合) - エンドユーザー体験向上

## ⚠️ リスクと対策

### リスク
- 政府サイトのアクセス制限・IP制限
- ページ構造の予期しない変更
- 大量データ収集時の技術的問題

### 対策
- 適切なレート制限とUser-Agent設定
- 段階的なテスト・検証アプローチ
- フォールバック機能とエラー処理

## 📈 成功指標

- ✅ 100% 実データによる質問主意書データベース
- ✅ 95%以上のURL有効性
- ✅ 質問番号・内容・URL の完全一致
- ✅ リアルタイムでのデータ品質監視