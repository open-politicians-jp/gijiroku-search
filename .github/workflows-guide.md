# GitHub Actions ワークフロー構成

## ワークフロー一覧と役割

### 🌐 デプロイ系

#### `deploy-github-pages.yml` ⭐ **GitHub Pages専用**
- **目的**: フロントエンドのGitHub Pagesデプロイ
- **トリガー**: mainブランチpush、手動実行
- **処理内容**:
  - 既存データファイルを使用
  - Next.jsビルド（静的サイト生成）
  - GitHub Pagesにデプロイ
- **データ収集**: ❌ なし（高速デプロイ）

#### `deploy.yml` - Vercel用（予備）
- **目的**: Vercelへのデプロイ（将来使用予定）
- **現状**: GitHub Pages使用のため非アクティブ

### 📊 データ収集系

#### `data-collection.yml` - 毎日自動実行
- **目的**: 議事録・質問・法案等の定期収集
- **トリガー**: 毎日午前3時JST（cron）、手動実行
- **処理内容**:
  - 国会API、公式サイトからデータ収集
  - JSON形式で保存
  - 自動コミット

#### `data-processing.yml` - データ後処理
- **目的**: 収集データの加工・統合
- **トリガー**: データ収集後、手動実行

### 🔍 開発・テスト系

#### `ci.yml` - 継続的インテグレーション
- **目的**: コード品質チェック
- **トリガー**: Pull Request、mainブランチpush
- **処理内容**:
  - ESLint、TypeScript型チェック
  - ビルドテスト

### 📈 特別収集系

#### `fetch_history.yml` - 履歴データ収集
- **目的**: 過去データの一括収集
- **トリガー**: 手動実行のみ

#### `fetch_latest.yml` - 最新データ収集
- **目的**: 最新データの即座収集
- **トリガー**: 手動実行のみ

#### `parliamentary-data-collection.yml` - 国会データ専用
- **目的**: 国会関連データの包括的収集
- **トリガー**: 手動実行のみ

## 推奨運用フロー

### 🚀 通常のデプロイ
```
1. コード変更・コミット → mainブランチpush
2. deploy-github-pages.yml が自動実行
3. 既存データでフロントエンドをビルド・デプロイ
4. 数分で更新完了
```

### 📊 データ更新
```
1. data-collection.yml が毎日自動実行（午前3時）
2. または、手動で Actions → data-collection.yml → Run workflow
3. 新しいデータが収集・コミット
4. 自動的にデプロイワークフローがトリガー
5. 最新データでサイト更新
```

### 🔧 開発時
```
1. 機能ブランチで開発
2. Pull Request作成 → ci.yml でテスト
3. レビュー・承認後にmainにマージ
4. 自動デプロイ実行
```

## ワークフローの無効化・有効化

### 不要なワークフローの無効化
```yaml
# ワークフローファイルの先頭に追加
on: []  # すべてのトリガーを無効化
```

### 使用しないワークフロー
- `deploy.yml` - Vercel用（現在未使用）
- `fetch_*.yml` - 必要時のみ手動実行

## メンテナンス

### 定期チェック項目
1. **データ収集の成功率**: Actions履歴を確認
2. **デプロイ成功率**: GitHub Pages URL動作確認
3. **ワークフロー実行時間**: 制限内かチェック

### トラブルシューティング
- **デプロイ失敗**: ビルドログでエラー確認
- **データ収集失敗**: API制限、サイト変更を確認
- **容量不足**: 大きなファイルの分割実行

## GitHub Actions制限

### 無料プラン制限
- **プライベートリポジトリ**: 月2,000分
- **パブリックリポジトリ**: 無制限
- **ストレージ**: 500MB

### 最適化ポイント
- キャッシュ使用でビルド時間短縮
- 不要なワークフローの無効化
- 条件分岐で実行頻度調整